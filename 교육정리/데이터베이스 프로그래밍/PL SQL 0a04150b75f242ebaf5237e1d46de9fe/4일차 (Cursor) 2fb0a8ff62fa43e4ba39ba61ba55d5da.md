# 4일차 (Cursor)

# Cursor 란?

![Untitled](4%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%8E%E1%85%A1%20(Cursor)%202fb0a8ff62fa43e4ba39ba61ba55d5da/Untitled.png)

![Untitled](4%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%8E%E1%85%A1%20(Cursor)%202fb0a8ff62fa43e4ba39ba61ba55d5da/Untitled%201.png)

![Untitled](4%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%8E%E1%85%A1%20(Cursor)%202fb0a8ff62fa43e4ba39ba61ba55d5da/Untitled%202.png)

![Untitled](4%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%8E%E1%85%A1%20(Cursor)%202fb0a8ff62fa43e4ba39ba61ba55d5da/Untitled%203.png)

**FETCH는 한 개의 ROW씩 처리한다.**

## 커서의 종류

![Untitled](4%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%8E%E1%85%A1%20(Cursor)%202fb0a8ff62fa43e4ba39ba61ba55d5da/Untitled%204.png)

![Untitled](4%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%8E%E1%85%A1%20(Cursor)%202fb0a8ff62fa43e4ba39ba61ba55d5da/Untitled%205.png)

### 암시적 커서 속성

```sql
SET SERVEROUTPUT ON
BEGIN
// 첫번째 DELETE
DELETE FROM EMP WHERE SAL > 2000;
DBMS_OUTPUT.PUT_LINE('[1-DELETE]'||TO_CHAR(SQL%ROWCOUNT)||'ROWS IS DELETED');
IF SQL%FOUND THEN
DBMS_OUTPUT.PUT_LINE('SQL%FOUND = TRUE ');
ELSE
DBMS_OUTPUT.PUT_LINE('SQL%NOTFOUND = FALSE ');
END IF;
DBMS_OUTPUT.PUT_LINE('-------------------------------------------------');
// 두번째 DELETE : 동일한 DELETE 를 2번째 실행하므로 삭제할 데이타가 없음
DELETE FROM EMP WHERE SAL > 2000;
DBMS_OUTPUT.PUT_LINE('[2-DELETE]'||TO_CHAR(SQL%ROWCOUNT)||'ROWS IS DELETED');
IF SQL%FOUND THEN
DBMS_OUTPUT.PUT_LINE('SQL%FOUND = TRUE');
ELSE
DBMS_OUTPUT.PUT_LINE('SQL%NOTFOUND = FALSE');
END IF;
ROLLBACK;
END;
/
```

```sql
TRUNCATE TABLE BONUS; -- DDL
DECLARE
CURSOR CUR_EMP IS
SELECT EMPNO,JOB,SAL,COMM FROM EMP WHERE DEPTNO = 10;
V_ENAME VARCHAR2(10);
V_JOB VARCHAR2(9);
V_SAL NUMBER(7,2);
V_COMM NUMBER(7,2);
BEGIN
OPEN CUR_EMP;
LOOP
FETCH CUR_EMP INTO V_ENAME,V_JOB,V_SAL,V_COMM ;
EXIT WHEN CUR_EMP%NOTFOUND;
-- Business Logic
INSERT INTO BONUS(ENAME,JOB,SAL,COMM) VALUES(V_ENAME,V_JOB,V_SAL,V_COMM); 
END LOOP;
DBMS_OUTPUT.PUT_LINE('TOTAL '||TO_CHAR(CUR_EMP%ROWCOUNT)||' rows processed');
CLOSE CUR_EMP;
COMMIT;
END;
/
SELECT * FROM BONUS;
```

## 명시적 커서 속성

![Untitled](4%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%8E%E1%85%A1%20(Cursor)%202fb0a8ff62fa43e4ba39ba61ba55d5da/Untitled%206.png)

![Untitled](4%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%8E%E1%85%A1%20(Cursor)%202fb0a8ff62fa43e4ba39ba61ba55d5da/Untitled%207.png)

![Untitled](4%E1%84%8B%E1%85%B5%E1%86%AF%E1%84%8E%E1%85%A1%20(Cursor)%202fb0a8ff62fa43e4ba39ba61ba55d5da/Untitled%208.png)

```sql
TRUNCATE TABLE BONUS;
SET SERVEROUTPUT ON
DECLARE
CURSOR CUR_EMP IS
SELECT ENAME,JOB,SAL,COMM FROM EMP WHERE DEPTNO = 10;
V_ENAME EMP.ENAME%TYPE;
V_JOB EMP.JOB%TYPE;
V_SAL EMP.SAL%TYPE;
V_COMM EMP.COMM%TYPE;
BEGIN
OPEN CUR_EMP;
LOOP
FETCH CUR_EMP INTO V_ENAME,V_JOB,V_SAL,V_COMM ;
EXIT WHEN CUR_EMP%NOTFOUND;
INSERT INTO BONUS(ENAME,JOB,SAL,COMM) VALUES(V_ENAME,V_JOB,V_SAL,V_COMM);
END LOOP;
DBMS_OUTPUT.PUT_LINE('TOTAL '||TO_CHAR(CUR_EMP%ROWCOUNT)||' rows processed');
CLOSE CUR_EMP;
COMMIT;
END;
/
SELECT * FROM BONUS;
```